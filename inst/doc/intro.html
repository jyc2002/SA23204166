<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="By SA23204166金亦成" />

<meta name="date" content="2023-12-05" />

<title>SA23204166function</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">SA23204166function</h1>
<h4 class="author">By SA23204166金亦成</h4>
<h4 class="date">2023-12-05</h4>



<div id="函数1rs_pa" class="section level2">
<h2>函数1：RS_PA</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>RS_PA <span class="ot">&lt;-</span> <span class="cf">function</span>(X,T,a) {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  n<span class="ot">=</span><span class="fu">dim</span>(X)[<span class="dv">1</span>]</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  sig<span class="ot">=</span><span class="fu">svd</span>(X)<span class="sc">$</span>d</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  sig0<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,n<span class="sc">*</span>T),<span class="at">nrow =</span> T)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>T) {</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    mat<span class="ot">=</span><span class="fu">matrix</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">rbinom</span>(n<span class="sc">^</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)<span class="sc">-</span><span class="dv">1</span>,<span class="at">nrow =</span> n)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    upper_triangle <span class="ot">&lt;-</span> <span class="fu">upper.tri</span>(mat)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    s_m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(mat), <span class="at">ncol =</span> <span class="fu">ncol</span>(mat))</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    s_m[upper_triangle] <span class="ot">&lt;-</span> mat[upper_triangle]</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    s_m[<span class="fu">lower.tri</span>(s_m)] <span class="ot">&lt;-</span> <span class="fu">t</span>(s_m)[<span class="fu">lower.tri</span>(s_m)]</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    sig0[t,]<span class="ot">=</span><span class="fu">svd</span>(X<span class="sc">*</span>s_m)<span class="sc">$</span>d</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  }</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  sig1<span class="ot">=</span><span class="fu">apply</span>(sig0, <span class="dv">2</span>, quantile, <span class="at">probs =</span> a)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  k<span class="ot">=</span><span class="fu">which</span>(sig <span class="sc">&lt;</span> sig1)[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="fu">return</span>(k)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>}</span></code></pre></div>
<div id="函数1背景" class="section level3">
<h3>函数1背景：</h3>
<p>平行分析（PA）是一种选取主成分个数的方法，可以通过以下几个步骤来完成：首先，生成多组随机数据的矩阵，这些矩阵和真实的数据矩阵要有相同的变量个数和被试的个数。然后，求出这组随机数据矩阵的特征值，并计算这些特征值的上<span class="math inline">\(\alpha\)</span>分位数。最后，通过比较真实数据中特征值的碎石图和这组随机矩阵的平均特征值的曲线，我们可以找到两条特征值曲线的交点，根据交点的位置，我们就可以确定要抽取主成分的绝对最大数目。如果真实数据的特征值落在随机矩阵的平均特征值曲线之上，则保留这些主成分；反之，则舍弃这些主成分。</p>
<p>为了解决具有异质噪声的数据的主成分个数选取问题，Hong(2020)中提出了随机符号翻转平行分析的方法，他将数据矩阵的每个元素进行了随机符号翻转，得到新的数据，他说明在此操作之下，数据中信号的部分被完全破坏掉同时误差的部分仍保留，因此原先数据比后得到数据主成分大的部分是该保留的主成分，由此合理的选取了具有异质噪声的数据中主成分的个数。但是给文章中限制了数据中的误差部分的范数恒定的条件，但是一般的随机图数据没法保证该条件。在我的毕业设计中，我和韩潇老师通过理论证明，发现这种方法也对于一般的随机图，只要随机图中的每个信号的信号强度随着节点个数n的变化保持在同一量级即可，且通过这种方式求得的显著的特征值的个数可以被视为是随机图中的社区个数。</p>
<p>由此我构造了一个R函数RS_PA，只要输入一个随机图的邻接矩阵，通过该函数即可通过上述的方法识别出该随机图的显著的特征值的个数，也就是给出该随机图中蕴含的潜在的社区个数。</p>
</div>
<div id="函数1说明" class="section level3">
<h3>函数1说明：</h3>
<div id="输入" class="section level4">
<h4>输入：</h4>
<ul>
<li>X:数据随机图的邻接矩阵,n个节点,则输入一个n行n列的0-1邻接矩阵</li>
<li>T:进行重复Random Signflips的试验次数</li>
<li>a:平行分析所采用的分位数</li>
</ul>
</div>
<div id="输出" class="section level4">
<h4>输出：</h4>
<ul>
<li>k:通过上述背景中Random
Signflip平行分析得到的随机图邻接矩阵的显著特征值的个数，即随机图中潜在的社区个数</li>
</ul>
</div>
</div>
<div id="函数1例子" class="section level3">
<h3>函数1例子：</h3>
<div id="模拟数据" class="section level4">
<h4>模拟数据：</h4>
<ul>
<li>创建一个ER随机图邻接矩阵sim_data，则理论社区个数k=1，取大小为50个节点，相连概率p为0.2的ER随机图,取T为300，a为0.95</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>mat<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rbinom</span>(<span class="dv">50</span><span class="sc">^</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="fl">0.2</span>),<span class="at">ncol=</span><span class="dv">50</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>upper_triangle <span class="ot">&lt;-</span> <span class="fu">upper.tri</span>(mat)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(mat), <span class="at">ncol =</span> <span class="fu">ncol</span>(mat))</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>sim_data[upper_triangle] <span class="ot">&lt;-</span> mat[upper_triangle]</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>sim_data[<span class="fu">lower.tri</span>(sim_data)] <span class="ot">&lt;-</span> <span class="fu">t</span>(sim_data)[<span class="fu">lower.tri</span>(sim_data)]</span></code></pre></div>
<ul>
<li>将ER随机图邻接矩阵sim_data作用上RS_PA，观察得到的k社区个数也为1</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">RS_PA</span>(sim_data,<span class="dv">300</span>,<span class="fl">0.95</span>))</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
<div id="真实数据" class="section level4">
<h4>真实数据：</h4>
<ul>
<li>Dolphins
dataset:该数据集包含了由Lusseau等人（2003年）编制的，位于新西兰Doubtful
Sound的一个社群中的62只海豚之间频繁关联的无向社交网络。</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">data</span>(dolphins)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">RS_PA</span>(dolphins,<span class="dv">300</span>,<span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<ul>
<li>Football
dataset:该数据集包含了由M.Girvan和M.Newman编制的，涵盖了2000年秋季常规赛季美国大学分区IA间橄榄球比赛的网络。</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">data</span>(football)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">RS_PA</span>(football,<span class="dv">300</span>,<span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<ul>
<li>Karate dataset:该数据集包含了由Wayne
Zachary于1977年描述的美国大学一个空手道俱乐部的34名成员之间的友谊网络。</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">data</span>(karate)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">RS_PA</span>(karate,<span class="dv">300</span>,<span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<ul>
<li>Polbooks
dataset:关于美国政治的图书网络，节点表示由在线书商Amazon.com销售的有关美国政治的图书。边表示相同购买者频繁共同购买书籍，如在Amazon上的“购买了此书的顾客也购买了这些其他书籍”功能中所示。</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">data</span>(polbooks)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">RS_PA</span>(polbooks,<span class="dv">300</span>,<span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
</div>
</div>
</div>
<div id="函数2beta_p_value" class="section level2">
<h2>函数2：beta_P_value</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co">#include &lt;RcppArmadillo.h&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>using namespace Rcpp;</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> [[Rcpp<span class="sc">::</span><span class="fu">depends</span>(RcppArmadillo)]]</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> [[Rcpp<span class="sc">::</span><span class="fu">plugins</span>(cpp11)]]</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> [[Rcpp<span class="sc">::</span>export]]</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>double <span class="fu">beta_P_value</span>(arma<span class="sc">::</span>vec Y, arma<span class="sc">::</span>mat X,arma<span class="sc">::</span>vec beta) {</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  int n <span class="ot">=</span> X.n_rows;</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  int pn <span class="ot">=</span> X.n_cols;</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  arma<span class="sc">::</span>vec beta_hat <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">trans</span>(X) <span class="sc">*</span> X, <span class="fu">trans</span>(X) <span class="sc">*</span> Y);</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  arma<span class="sc">::</span>mat XTX_inv <span class="ot">=</span> <span class="fu">inv</span>(<span class="fu">trans</span>(X) <span class="sc">*</span> X);</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>  double sigma_hat <span class="ot">=</span> <span class="fu">as_scalar</span>(<span class="fu">trans</span>(Y <span class="sc">-</span> X <span class="sc">*</span> beta_hat) <span class="sc">*</span> (Y <span class="sc">-</span> X <span class="sc">*</span> beta_hat) <span class="sc">/</span> (n <span class="sc">-</span> pn));</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>  double var <span class="ot">=</span> <span class="dv">4</span> <span class="sc">*</span> sigma_hat <span class="sc">*</span> <span class="fu">as_scalar</span>(<span class="fu">trans</span>(beta_hat) <span class="sc">*</span> XTX_inv <span class="sc">*</span> beta_hat) <span class="sc">-</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pow</span>(sigma_hat, <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">diagvec</span>(XTX_inv <span class="sc">*</span> XTX_inv)) <span class="sc">+</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pow</span>(sigma_hat, <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">pow</span>(<span class="fu">sum</span>(<span class="fu">diagvec</span>(XTX_inv)), <span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">-</span> pn);</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>  double obs <span class="ot">=</span> (<span class="fu">as_scalar</span>(<span class="fu">trans</span>(beta_hat<span class="sc">-</span>beta) <span class="sc">*</span> (beta_hat<span class="sc">-</span>beta)) <span class="sc">-</span> sigma_hat<span class="sc">*</span><span class="fu">sum</span>(<span class="fu">diagvec</span>(XTX_inv))) <span class="sc">/</span> <span class="fu">sqrt</span>(var);</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>  double P_value <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> R<span class="sc">::</span><span class="fu">pnorm</span>(std<span class="sc">::</span><span class="fu">abs</span>(obs), <span class="fl">0.0</span>, <span class="fl">1.0</span>, true, false));</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>  return P_value;</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>}</span></code></pre></div>
<div id="函数2背景" class="section level3">
<h3>函数2背景：</h3>
<p>线性回归模型是最广泛使用的统计工具之一,
用于发现一个或多个解释变量与响应变量之间的关系。我们考虑异方差下的线性回归模型
<span class="math display">\[
Y_i=\boldsymbol{X}_i^T \boldsymbol{\beta}_0+\epsilon_i, \quad \text {
for } i=1, \ldots, n,
\]</span></p>
<p>其中 <span class="math inline">\(\boldsymbol{\beta}_0=\left(\beta_{0,1}, \ldots,
\beta_{0, p_n}\right)^T \in \mathbb{R}^{p_n}\)</span>
是一个未知的参数向量。 <span class="math inline">\(\left\{\epsilon_i\right\}_{i=1}^n\)</span>
是独立于 <span class="math inline">\(\left\{\boldsymbol{X}_i\right\}_{i=1}^n\)</span>
的误差, 其中假设 <span class="math inline">\(\mathrm{E}\left(\epsilon_i\right)=0,
\operatorname{Var}\left(\epsilon_i\right)=\sigma_i^2\)</span>
且任意两个误差独立。我们用 <span class="math inline">\(D=\operatorname{diag}\left(\sigma_1^2, \sigma_2^2,
\ldots, \sigma_n^2\right)\)</span>来表示误差方差矩阵。我们假设 <span class="math inline">\(\left\{Y_i,
\boldsymbol{X}_i\right\}_{i=1}^n\)</span> 是独立同分布的观测值, 其中
<span class="math inline">\(\mathrm{E}\left(\boldsymbol{X}_i\right)=\mathbf{0}_{p_n}\)</span>
且 <span class="math inline">\(\operatorname{Cov}\left(\boldsymbol{X}_i\right)=\Sigma\)</span>,
在整篇论文中我们没有对 <span class="math inline">\(\boldsymbol{X}_i\)</span> 或 <span class="math inline">\(\epsilon_i\)</span>
强加其符合任何特定分布的假设。我们定义 <span class="math inline">\(\boldsymbol{Y}=\left(Y_1, \ldots, Y_n\right)^T,
X=\left(\boldsymbol{X}_1, \ldots, \boldsymbol{X}_n\right)^T\)</span> 和
<span class="math inline">\(\boldsymbol{\epsilon}=\left(\epsilon_1,
\ldots, \epsilon_n\right)^T,\)</span> <span class="math display">\[
\boldsymbol{Y}=X \boldsymbol{\beta}_0+\boldsymbol{\epsilon}
\]</span></p>
<p>对于固定维度且存在 <span class="math inline">\(\sigma_\epsilon^2\)</span> 对于所有 <span class="math inline">\(i\)</span> 使得 <span class="math inline">\(\sigma_i^2=\sigma_\epsilon^2\)</span> 的情形,
基于普通最小二乘法 (OLS)估计量, 我们可以对于 <span class="math inline">\(\boldsymbol{\beta}_0\)</span> 和 <span class="math inline">\(\sigma_\epsilon^2\)</span>
有很好的估计和统计推断的结果, <span class="math display">\[
\hat{\boldsymbol{\beta}}=\left(X^T X\right)^{-1} X^T \boldsymbol{Y} .
\]</span></p>
<p>但是在现代高维统计领域研究中, 参数维度 <span class="math inline">\(p_n\)</span> 被允许可以比 <span class="math inline">\(n\)</span> 大得多, 例如 <span class="math inline">\(\log p_n / n=\)</span> <span class="math inline">\(O(1)\)</span>, 但在大多数情况下,
在相关高维统计研究论文中要求 <span class="math inline">\(\boldsymbol{\beta}_0\)</span> 中非零元素的数量随着
<span class="math inline">\(n\)</span>变化不会快速增加, 即对于 <span class="math inline">\(\boldsymbol{\beta}_0\)</span>
有一定的稀疏性条件假设。然而实际上, <span class="math inline">\(p_n\)</span> 可能适度大, 即与 <span class="math inline">\(n\)</span> 大小相近或者成比例时,
我们不一定需要规定 <span class="math inline">\(\boldsymbol{\beta}_0\)</span> 稀疏。</p>
<p>对于具有 <span class="math inline">\(\lim _{n \rightarrow \infty} p_n
/ n=\tau \in(0,1)\)</span> 性质的中等维度, 这是本文主要关注的维度,
一些为固定维度数据开发的经典统计推理结果不再有效。例如, 当 <span class="math inline">\(p_n\)</span> 固定时且已知常数 <span class="math inline">\(c_0 \geq 0\)</span>, <span class="math display">\[
H_0:\left\|\boldsymbol{\beta}_0\right\|_2=c_0 \text { versus }
H_1:\left\|\boldsymbol{\beta}_0\right\|_2 \neq c_0,
\]</span></p>
<p>我们通过计算 Z-score 统计量做检验 <span class="math display">\[
\mathbb{Z}_0=\frac{\|\hat{\boldsymbol{\beta}}\|_2^2-c_0^2}{\hat{\zeta}_0},
\]</span></p>
<p>其中 <span class="math display">\[
\hat{\zeta}_0^2=4 \hat{\sigma}_\epsilon^2
\hat{\boldsymbol{\beta}}^T\left(X^T X\right)^{-1}
\hat{\boldsymbol{\beta}} \quad \text { and } \quad
\hat{\sigma}_\epsilon^2=\frac{\|\boldsymbol{Y}-X
\hat{\boldsymbol{\beta}}\|_2^2}{n-p_n} .
\]</span></p>
<p>在原假设下, <span class="math inline">\(\mathbb{Z}_0
\stackrel{\mathcal{D}}{\rightarrow} N(0,1)\)</span> 。因此, 检验 <span class="math inline">\((1.2)\)</span> 的 <span class="math inline">\(\mathrm{P}\)</span> 值为 <span class="math inline">\(2
\Phi\left(-\left|\mathbb{Z}_0\right|\right)\)</span>, 其中 <span class="math inline">\(\mathbb{Z}_0\)</span> 是 <span class="math inline">\(\mathbb{Z}_0\)</span> 的一次实现, 而 <span class="math inline">\(\Phi(\cdot)\)</span>
是标准正态分布的累积分布函数。</p>
<p>在进行模拟之后, Guo &amp; Cheng (2022) 发现上述的 Z-score
统计量在中等维度假设检验下表现不是十分良好。</p>
<p>对上述检验问题，在我的大学生创新研究课题中，我和郭潇老师提出了一个新的检验统计量<span class="math inline">\(\mathbb{Z}_n=\frac{\widehat{\|\boldsymbol{\beta}\|_2^2}-c_0^2}{\hat{\zeta}_n}\)</span>，其中<span class="math inline">\(\widehat{\|\boldsymbol{\beta}\|_2^2}=\|\hat{\boldsymbol{\beta}}\|_2^2-\operatorname{tr}\left\{\left(X^T
X\right)^{-1}\right\} \hat{\sigma}_\epsilon^2,\)</span><span class="math inline">\(\hat{\zeta}_n^2=4 \hat{\sigma}_\epsilon^2
\hat{\boldsymbol{\beta}}^T\left(X^T X\right)^{-1}
\hat{\boldsymbol{\beta}}-2 \hat{\sigma}_\epsilon^4
\operatorname{tr}\left\{\left(X^T X\right)^{-2}\right\}+2
\hat{\sigma}_\epsilon^4\left[\operatorname{tr}\left\{\left(X^T
X\right)^{-1}\right\}\right]^2 /\left(n-p_n\right) .\)</span>
通过证明我们发现，这个检验统计量在中等维度异方差情形下，可以保证渐进正态性质，即是一个非常良好的检验统计量。同时我们考虑更广泛的全局检验问题：
<span class="math display">\[
H_0: \boldsymbol{\beta}_0=\boldsymbol{\beta}_0^{\text {null }} \quad
\text { versus } \quad H_1: \boldsymbol{\beta}_0 \neq
\boldsymbol{\beta}_0^{\text {null }}
\]</span></p>
<p>通过提出基于 <span class="math inline">\(\left\|\hat{\boldsymbol{\beta}}-\boldsymbol{\beta}_0^{\text
{null }}\right\|_2^2\)</span> 的偏差和方差校正的检验统计量, 如下所示
<span class="math display">\[
\mathbb{G}_n=\frac{\left\|\hat{\boldsymbol{\beta}}-\boldsymbol{\beta}_0^{\text
{null }}\right\|_2^2-\operatorname{tr}\left\{\left(X^T
X\right)^{-1}\right\} \hat{\sigma}_\epsilon^2}{\hat{\zeta}_*} .
\]</span> <span class="math inline">\(\mathbb{G}_n\)</span> 的构造是基于
<span class="math inline">\(\hat{\boldsymbol{\beta}}-\boldsymbol{\beta}_0^{\text
{null }}\)</span> 在中 <span class="math inline">\(H_0\)</span>
下的分布与 <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span>
相同其中 <span class="math inline">\(\boldsymbol{\beta}_0=\mathbf{0}_{p_n}\)</span>
。因此, 偏差校正量 <span class="math inline">\(-\operatorname{tr}\left\{\left(X^T
X\right)^{-1}\right\} \hat{\sigma}_\epsilon^2\)</span> 和方差项 <span class="math inline">\(\hat{\zeta}_*^2\)</span> 为 <span class="math inline">\(\mathbb{G}_n\)</span> 与 <span class="math inline">\(\mathbb{Z}_n\)</span> 相同。 从 <span class="math inline">\(\mathbb{Z}_n\)</span> 的渐近结果来看, <span class="math inline">\(\mathbb{G}_n\)</span> 对于发散 <span class="math inline">\(p_n\)</span> 也是原假设下符合渐近标准正态分布,
我们最终构造出一个合适的在中等维度异方差情形下全局检验问题的检验统计量。</p>
<p>我用Rcpp写了对应的函数beta_P_value，这个函数是基于全局检验检验统计量<span class="math inline">\(\mathbb{G}_n\)</span>，在给出数据<span class="math inline">\(X,Y\)</span>以及原假设参数<span class="math inline">\(\beta_0^\text{null}\)</span>下求得的检验P值。</p>
</div>
<div id="函数2说明" class="section level3">
<h3>函数2说明：</h3>
<div id="输入-1" class="section level4">
<h4>输入：</h4>
<ul>
<li>Y:因变量数据向量,n个样本,则输入一个n个元素的数据向量</li>
<li>X:自变量数据矩阵,n个样本,p个特征,则输入一个n行p列的数据矩阵</li>
<li>beta:全局检验中<span class="math inline">\(H_0:
\boldsymbol{\beta}_0=\boldsymbol{\beta}_0^{\text {null }} \quad \text
{vs} \quad H_1: \boldsymbol{\beta}_0 \neq \boldsymbol{\beta}_0^{\text
{null
}}\)</span>中所使用原假设的参数向量，p个特征,则输入一个p个元素的参数向量</li>
</ul>
</div>
<div id="输出-1" class="section level4">
<h4>输出：</h4>
<ul>
<li>P-value:全局检验中<span class="math inline">\(H_0:
\boldsymbol{\beta}_0=\boldsymbol{\beta}_0^{\text {null }} \quad \text
{vs} \quad H_1: \boldsymbol{\beta}_0 \neq \boldsymbol{\beta}_0^{\text
{null }}\)</span>利用上述背景中所提的检验统计量<span class="math inline">\(\mathbb{G}_n\)</span>在真实数据X和Y下做检验得到的P值</li>
</ul>
</div>
</div>
<div id="函数2例子" class="section level3">
<h3>函数2例子：</h3>
<div id="模拟数据-1" class="section level4">
<h4>模拟数据：</h4>
<ul>
<li>取样本个数n=1000，特征个数pn=900，自变量数据矩阵X中每个元素从标准正态分布中获取，我们假设数据异方差，即我们取误差epsilon为正态分布，其每个元素的方差随机从0-1均匀分布中得到，同时真实参数beta从0-1均匀分布中得到，Y=X*beta+epsilon</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">1000</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>pn<span class="ot">=</span><span class="dv">900</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>beta<span class="ot">&lt;-</span><span class="fu">runif</span>(pn)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>sigma<span class="ot">&lt;-</span><span class="fu">runif</span>(n)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>X<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">rnorm</span>(pn<span class="sc">*</span>n),<span class="at">nrow =</span> n,<span class="at">ncol =</span> pn)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>epsilon<span class="ot">&lt;-</span><span class="fu">numeric</span>(n)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n)epsilon[j]<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span> <span class="dv">0</span>,<span class="at">sd =</span> sigma)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>Y<span class="ot">&lt;-</span>X<span class="sc">%*%</span>beta<span class="sc">+</span>epsilon</span></code></pre></div>
<ul>
<li>首先我们取原假设中的参数为全是0的向量，即检验真实参数是否具有显著的全是0，带入beta_P_value(Y,X,rep(0,pn))，我们发现数据是0，也就是说拒绝原假设真实参数不全是0</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">beta_P_value</span>(Y,X,<span class="fu">rep</span>(<span class="dv">0</span>,pn)))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<ul>
<li>我们取真实的beta到假设中，带入beta_P_value(Y,X,beta)，我们发现数据是0.9894342，也就是说无法拒绝原假设，由此可见我们提出的检验和对应的P值十分合理</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">beta_P_value</span>(Y,X,beta))</span></code></pre></div>
<pre><code>## [1] 0.9894342</code></pre>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
